@startuml
title Activity Diagram - Admin (Corrected - Backend Only)

|#LightPink|Admin|
start
:POST /api/auth/login\n{email, password};

|#LightYellow|Sistem Web|
:Validasi Email & Password\n(bcrypt.compare);

|#E6F3FF|Database|
:SELECT * FROM users\nWHERE email = ?;

|#LightYellow|Sistem Web|
if (User Ditemukan &\nPassword Cocok?) then (Ya)
  :Generate Token JWT\n(user_id, email, role);
  :Return {token, user};

  |#LightPink|Admin|
  :GET /api/admin/statistics\n(Header: Bearer token);

  |#LightYellow|Sistem Web|
  :Validate JWT Token;
  :Check role (middleware);

  if (Role = Admin?) then (Ya)
    |#E6F3FF|Database|
    :COUNT laporan by status\nCOUNT petugas;

    |#LightYellow|Sistem Web|
    :Return Statistics JSON;

    |#LightPink|Admin|
    :GET /api/admin/laporan\n?status=pending;

    |#E6F3FF|Database|
    :SELECT * FROM laporan_kebersihan\nWHERE status = 'pending'\nORDER BY created_at DESC;

    |#LightYellow|Sistem Web|
    :Return List Laporan + Pagination;

    |#LightPink|Admin|
    :GET /api/admin/laporan/:id;

    |#E6F3FF|Database|
    :Load Detail Laporan\n+ JOIN users (petugas & admin);

    |#LightYellow|Sistem Web|
    :Return Detail Laporan;

    |#LightPink|Admin|
    :PUT /api/admin/laporan/:id/verify\n{status: "valid"|"invalid",\ncatatan_admin: "..."};

    |#E6F3FF|Database|
    if (status = 'pending'?) then (Ya)
      :UPDATE laporan_kebersihan\nSET status, validated_by,\ncatatan_admin;

      |#LightYellow|Sistem Web|
      :Return 200 OK\n{laporan updated};

      |#LightPink|Admin|
      :Verifikasi Berhasil;
    else (Sudah Diverifikasi)
      |#LightYellow|Sistem Web|
      :Return 400 Error\n"Laporan sudah diverifikasi";
      |#LightPink|Admin|
      :Tampilkan Error;
    endif

    :POST /api/auth/logout;
    |#LightYellow|Sistem Web|
    :Return 200 OK;

  else (Bukan Admin)
    |#LightYellow|Sistem Web|
    :Return 403 Forbidden;
  endif

else (Tidak)
  :Return 401 Unauthorized\n"Email atau password salah";
  |#LightPink|Admin|
  :Tampilkan Error Login;
endif

stop

note right
  ‚ùå REMOVED:
  - Dashboard UI (tidak ada frontend)
  - Peta & Grafik (tidak ada frontend)
  - Notifikasi ke Petugas (tidak diimplementasi)
end note

@enduml
